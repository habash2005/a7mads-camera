import{r as n,q as A,c as D,d as k,o as q,g as B,j as e,u as $,a as E}from"./index-B2WSoumr.js";const M={pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",done:"bg-slate-200 text-slate-800"};function P(){const[x,m]=n.useState([]),[c,C]=n.useState("upcoming"),[o,S]=n.useState(""),[L,p]=n.useState(!0),[h,u]=n.useState("");n.useEffect(()=>{(async()=>{try{p(!0);const t=A(D(k,"bookings"),q("startAt","asc")),a=(await B(t)).docs.map(l=>({id:l.id,...l.data()}));m(a)}catch(t){console.error(t),u("Failed to load bookings.")}finally{p(!1)}})()},[]);const g=Date.now(),f=n.useMemo(()=>{let t=x.slice();if(c==="upcoming"&&(t=t.filter(s=>{var a;return((a=s.startAt)==null?void 0:a.toMillis())>=g})),c==="pending"&&(t=t.filter(s=>s.status==="pending")),c==="confirmed"&&(t=t.filter(s=>s.status==="confirmed")),o.trim()){const s=o.trim().toLowerCase();t=t.filter(a=>{var l,r,i;return(((l=a.details)==null?void 0:l.name)||"").toLowerCase().includes(s)||(((r=a.details)==null?void 0:r.email)||"").toLowerCase().includes(s)||(((i=a.package)==null?void 0:i.name)||"").toLowerCase().includes(s)||(a.reference||"").toLowerCase().includes(s)})}return t},[x,c,o,g]);async function d(t,s){try{await $(E(k,"bookings",t),{status:s}),m(a=>a.map(l=>l.id===t?{...l,status:s}:l))}catch(a){console.error(a),u("Could not update status.")}}return e.jsx("section",{className:"w-full py-16 md:py-24 bg-ivory",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-serif font-semibold text-charcoal",children:"Bookings"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"rounded-xl border border-rose/30 px-3 py-2 bg-white",value:c,onChange:t=>C(t.target.value),children:[e.jsx("option",{value:"upcoming",children:"Upcoming"}),e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"})]}),e.jsx("input",{className:"rounded-xl border border-rose/30 px-3 py-2 bg-white",placeholder:"Search name, email, ref…",value:o,onChange:t=>S(t.target.value)})]})]}),h&&e.jsx("div",{className:"mt-3 text-sm text-red-700",children:h}),e.jsx("div",{className:"mt-6 overflow-hidden rounded-2xl border border-slate-100 bg-white",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-rose-50 text-charcoal/80",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"When"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Client"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Package"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Ref"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:L?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-6 text-center text-slate-600",children:"Loading…"})}):f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-6 text-center text-slate-600",children:"No bookings."})}):f.map(t=>{var l,r,i,j,N,y,v,w,b;const s=((r=(l=t.startAt)==null?void 0:l.toDate)==null?void 0:r.call(l))||null,a=s?s.toLocaleString([],{dateStyle:"medium",timeStyle:"short"}):`${t.date} ${t.time}`;return e.jsxs("tr",{className:"border-t border-slate-100",children:[e.jsx("td",{className:"px-4 py-3",children:a}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium",children:(i=t.details)==null?void 0:i.name}),e.jsx("div",{className:"text-slate-500",children:(j=t.details)==null?void 0:j.email}),e.jsx("div",{className:"text-slate-500",children:(N=t.details)==null?void 0:N.phone})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium",children:(y=t.package)==null?void 0:y.name}),e.jsxs("div",{className:"text-slate-500",children:["$",(v=t.package)==null?void 0:v.price," — ",(w=t.package)==null?void 0:w.duration]}),e.jsx("div",{className:"text-slate-500",children:(b=t.details)==null?void 0:b.location})]}),e.jsx("td",{className:"px-4 py-3 font-mono",children:t.reference}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${M[t.status]||"bg-slate-100 text-slate-800"}`,children:t.status})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(t.id,"confirmed"),className:"px-3 py-1 rounded-full bg-green-600 text-white hover:bg-green-700",children:"Confirm"}),e.jsx("button",{onClick:()=>d(t.id,"cancelled"),className:"px-3 py-1 rounded-full bg-red-600 text-white hover:bg-red-700",children:"Cancel"}),e.jsx("button",{onClick:()=>d(t.id,"done"),className:"px-3 py-1 rounded-full bg-slate-800 text-white hover:bg-slate-900",children:"Done"})]})})]},t.id)})})]})})]})})}export{P as default};
