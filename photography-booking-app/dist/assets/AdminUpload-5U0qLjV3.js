import{r as l,g as v,c as N,d as A,j as e}from"./index-BMTlcuvm.js";const U="lamaphoto",F="lamaphoto_unsigned";function P(){var j;const[t,f]=l.useState("portfolio"),[a,w]=l.useState([]),[m,g]=l.useState(""),[r,u]=l.useState(!0),[h,i]=l.useState("");l.useEffect(()=>{let o=!1;return(async()=>{try{u(!0);const n=await v(N(A,"galleries"));if(o)return;const c=n.docs.map(d=>({id:d.id,...d.data()})).sort((d,p)=>(d.name||"").localeCompare(p.name||""));w(c),c.length&&g(c[0].id)}catch(n){console.error("[AdminUpload] Firestore galleries fetch failed:",n),i("Couldn’t load galleries (check network/rules). You can still upload to Portfolio.")}finally{o||u(!1)}})(),()=>{o=!0}},[]);const s=l.useMemo(()=>a.find(o=>o.id===m)||null,[a,m]),y=l.useCallback(()=>{if(!window.cloudinary){i("Upload widget not loaded yet. Try again in a second."),console.warn("[AdminUpload] window.cloudinary is undefined. Is the script loading?");return}const o=t==="portfolio",n=o?"portfolio":s==null?void 0:s.tag,c=o?"portfolio":"client-galleries";if(!o&&!n){i("Pick a client gallery first.");return}i(""),window.cloudinary.createUploadWidget({cloudName:U,uploadPreset:F,folder:c,tags:[n],multiple:!0,sources:["local","camera","url","google_drive","dropbox"],clientAllowedFormats:["jpg","jpeg","png","webp"],maxFileSize:2e7,styles:{palette:{window:"#FFF8F0",sourceBg:"#ffffff",windowBorder:"#F4A6A6",tabIcon:"#F4A6A6",menuIcons:"#333333",textDark:"#333333",link:"#F4A6A6",action:"#D4AF37",inProgress:"#F4A6A6",complete:"#D4AF37",error:"#ff4b4b"}}},(p,x)=>{if(p){console.error("[AdminUpload] Upload error:",p),i("Upload error — see console.");return}if((x==null?void 0:x.event)==="success"){const b=o?"Portfolio":(s==null?void 0:s.name)||"Gallery";i(`✅ Uploaded to ${b}: ${x.info.original_filename}`)}}).open()},[t,s]);return e.jsx("section",{className:"w-full py-16 md:py-24 bg-ivory",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-serif font-semibold text-charcoal",children:"Admin Upload"}),e.jsxs("p",{className:"text-charcoal/70 mt-1",children:["Upload to the public ",e.jsx("strong",{children:"Portfolio"})," or pick a ",e.jsx("strong",{children:"Client Gallery"}),"."]}),e.jsxs("div",{className:"mt-6 flex gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"mode",value:"portfolio",checked:t==="portfolio",onChange:()=>f("portfolio")}),e.jsx("span",{children:"Portfolio"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"mode",value:"client",checked:t==="client",onChange:()=>f("client")}),e.jsx("span",{children:"Client Gallery"})]})]}),t==="client"&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-charcoal",children:"Select gallery"}),e.jsxs("select",{className:"mt-2 w-full rounded-xl border border-rose/30 px-3 py-2 bg-white",disabled:r||a.length===0,value:m,onChange:o=>g(o.target.value),children:[r&&e.jsx("option",{children:"Loading…"}),!r&&a.length===0&&e.jsx("option",{children:"No galleries found"}),!r&&a.map(o=>e.jsxs("option",{value:o.id,children:[o.name," — ",o.slug," (",o.tag,")"]},o.id))]}),!r&&a.length===0&&e.jsx("div",{className:"text-xs text-charcoal/70 mt-2",children:"Create one in the “New Gallery” box above, then come back."})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:y,className:"rounded-full px-5 py-3 text-sm font-semibold shadow-md bg-rose text-ivory hover:bg-gold hover:text-charcoal transition-all",children:t==="portfolio"?"Upload to Portfolio":"Upload to Selected Gallery"})}),h&&e.jsx("div",{className:"mt-3 text-sm text-charcoal",children:h}),e.jsxs("div",{className:"mt-4 text-xs text-charcoal/70",children:["Portfolio uploads use tag ",e.jsx("code",{children:"portfolio"}),". Client uploads use the gallery’s tag (",e.jsx("code",{children:t==="client"?((j=a.find(o=>o.id===m))==null?void 0:j.tag)||"gal-&lt;slug&gt;":"portfolio"}),")."]})]})})}export{P as default};
