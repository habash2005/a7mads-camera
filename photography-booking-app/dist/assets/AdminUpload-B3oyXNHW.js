import{r as a,g as C,c as w,d as v,a as P,s as k,b as _,j as e}from"./index-B2WSoumr.js";const S="lamaphoto",D="lamaphoto_unsigned";function G(){var y;const[i,h]=a.useState("portfolio"),[s,A]=a.useState([]),[p,x]=a.useState(""),[c,b]=a.useState(!0),[j,r]=a.useState("");a.useEffect(()=>{let o=!1;return(async()=>{try{b(!0);const n=await C(w(v,"galleries"));if(o)return;const d=n.docs.map(m=>({id:m.id,...m.data()})).sort((m,f)=>(m.name||"").localeCompare(f.name||""));A(d),d.length&&x(d[0].id)}catch(n){console.error("[AdminUpload] Firestore galleries fetch failed:",n),r("Couldn’t load galleries (check network/rules). You can still upload to Portfolio.")}finally{o||b(!1)}})(),()=>{o=!0}},[]);const t=a.useMemo(()=>s.find(o=>o.id===p)||null,[s,p]),N=a.useCallback(()=>{if(!window.cloudinary){r("Upload widget not loaded yet. Try again in a second."),console.warn("[AdminUpload] window.cloudinary is undefined. Is the script loading?");return}const o=i==="portfolio",n=o?"portfolio":t==null?void 0:t.tag,d=o?"portfolio":"client-galleries";if(!o&&!n){r("Pick a client gallery first.");return}r(""),window.cloudinary.createUploadWidget({cloudName:S,uploadPreset:D,folder:d,tags:[n],multiple:!0,sources:["local","camera","url","google_drive","dropbox"],clientAllowedFormats:["jpg","jpeg","png","webp"],maxFileSize:2e7,styles:{palette:{window:"#FFF8F0",sourceBg:"#ffffff",windowBorder:"#F4A6A6",tabIcon:"#F4A6A6",menuIcons:"#333333",textDark:"#333333",link:"#F4A6A6",action:"#D4AF37",inProgress:"#F4A6A6",complete:"#D4AF37",error:"#ff4b4b"}}},async(f,g)=>{if(f){console.error("[AdminUpload] Upload error:",f),r("Upload error — see console.");return}if((g==null?void 0:g.event)==="success"){const l=g.info,U=o?"Portfolio":(t==null?void 0:t.name)||"Gallery";try{if(!o&&(t!=null&&t.id)){const u=w(v,`galleries/${t.id}/images`),F=P(u);await k(F,{public_id:l.public_id,format:l.format,bytes:l.bytes,width:l.width,height:l.height,secure_url:l.secure_url,original_filename:l.original_filename,version:l.version,tag:n,createdAt:_()})}r(`✅ Uploaded to ${U}: ${l.original_filename}`)}catch(u){console.error("[AdminUpload] Firestore write failed:",u),r("Uploaded to Cloudinary, but failed to save to Firestore.")}}}).open()},[i,t]);return e.jsx("section",{className:"w-full py-16 md:py-24 bg-ivory",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-serif font-semibold text-charcoal",children:"Admin Upload"}),e.jsxs("p",{className:"text-charcoal/70 mt-1",children:["Upload to the public ",e.jsx("strong",{children:"Portfolio"})," or pick a ",e.jsx("strong",{children:"Client Gallery"}),"."]}),e.jsxs("div",{className:"mt-6 flex gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"mode",value:"portfolio",checked:i==="portfolio",onChange:()=>h("portfolio")}),e.jsx("span",{children:"Portfolio"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"mode",value:"client",checked:i==="client",onChange:()=>h("client")}),e.jsx("span",{children:"Client Gallery"})]})]}),i==="client"&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm font-medium text-charcoal",children:"Select gallery"}),e.jsxs("select",{className:"mt-2 w-full rounded-xl border border-rose/30 px-3 py-2 bg-white",disabled:c||s.length===0,value:p,onChange:o=>x(o.target.value),children:[c&&e.jsx("option",{children:"Loading…"}),!c&&s.length===0&&e.jsx("option",{children:"No galleries found"}),!c&&s.map(o=>e.jsxs("option",{value:o.id,children:[o.name," — ",o.slug," (",o.tag,")"]},o.id))]}),!c&&s.length===0&&e.jsx("div",{className:"text-xs text-charcoal/70 mt-2",children:"Create one in the “New Gallery” box above, then come back."})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:N,className:"rounded-full px-5 py-3 text-sm font-semibold shadow-md bg-rose text-ivory hover:bg-gold hover:text-charcoal transition-all",children:i==="portfolio"?"Upload to Portfolio":"Upload to Selected Gallery"})}),j&&e.jsx("div",{className:"mt-3 text-sm text-charcoal",children:j}),e.jsxs("div",{className:"mt-4 text-xs text-charcoal/70",children:["Portfolio uploads use tag ",e.jsx("code",{children:"portfolio"}),". Client uploads use the gallery’s tag (",e.jsx("code",{children:i==="client"?((y=s.find(o=>o.id===p))==null?void 0:y.tag)||"gal-&lt;slug&gt;":"portfolio"}),")."]})]})})}export{G as default};
